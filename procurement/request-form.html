<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Procurement Request é‡‡è´­ç”³è¯·</title>
  <link rel="stylesheet" href="css/styles.css"/>
</head>
<body>

<header>
  <div class="header-content">
    <img class="site-logo" src="assets/logo.png" onerror="this.style.display='none'" alt=""/>
    <div class="header-text">
      <h1 id="hdr-title">Procurement Request</h1>
      <p id="hdr-sub">Central Kitchen Â· Submit a new item request</p>
    </div>
  </div>
  <nav class="nav-links">
    <button class="lang-toggle" id="langToggle" onclick="toggleLang()">ä¸­æ–‡</button>
    <a href="/">ğŸ  <span class="t" data-en="Home" data-zh="ä¸»é¡µ">Home</span></a>
    <a href="/requests">ğŸ“Š <span class="t" data-en="All Requests" data-zh="æ‰€æœ‰ç”³è¯·">All Requests</span></a>
  </nav>
</header>

<main>
  <div id="msgSuccess" class="msg success">âœ… <span class="t" data-en="Request submitted successfully!" data-zh="ç”³è¯·æäº¤æˆåŠŸï¼">Request submitted successfully!</span></div>
  <div id="msgError"   class="msg error">âŒ <span id="errText">Failed to submit. Please try again.</span></div>

  <form id="requestForm" enctype="multipart/form-data" style="max-width:680px;margin:0 auto;">

    <div class="card">
      <h2>ğŸ“¦ <span class="t" data-en="Item Request" data-zh="é‡‡è´­ç”³è¯·">Item Request</span></h2>

      <div class="form-row">
        <div class="form-group">
          <label><span class="t" data-en="Item Requested" data-zh="é‡‡è´­ç‰©å“">Item Requested</span> <span style="color:var(--accent)">*</span></label>
          <input type="text" name="itemNameEn" id="itemNameInput"
            placeholder="e.g. Commercial Blender / å•†ç”¨æ…æ‹Œæœº" required/>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="t" data-en="Quantity" data-zh="æ•°é‡">Quantity</label>
          <input type="text" name="quantity" id="qtyInput" placeholder="e.g. 2"/>
        </div>
        <div class="form-group">
          <label class="t" data-en="Department" data-zh="éƒ¨é—¨">Department</label>
          <input type="text" name="department" id="deptInput" placeholder="e.g. Pastry, Wok Station"/>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label><span class="t" data-en="Your Name" data-zh="å§“å">Your Name</span> <span style="color:var(--accent)">*</span></label>
          <input type="text" name="requestorName" id="nameInput" placeholder="Full name / å…¨å" required/>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="t" data-en="Comments / Reason" data-zh="å¤‡æ³¨ / åŸå› ">Comments / Reason</label>
          <textarea name="comments" id="commentsInput"
            placeholder="Why is this item needed? / ä¸ºä»€ä¹ˆéœ€è¦æ­¤ç‰©å“ï¼Ÿ"></textarea>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="t" data-en="Photo (optional, max 5MB)" data-zh="ç…§ç‰‡ï¼ˆå¯é€‰ï¼Œæœ€å¤§ 5MBï¼‰">Photo (optional, max 5MB)</label>
          <input type="file" name="image" id="imageInput" accept="image/*"/>
          <img id="imagePreview" style="max-width:220px;max-height:170px;border-radius:10px;margin-top:10px;display:none;border:1px solid var(--border);" alt="Preview"/>
        </div>
      </div>

      <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:8px;">
        <button type="submit" class="btn btn-primary">
          âœ… <span class="t" data-en="Submit Request" data-zh="æäº¤ç”³è¯·">Submit Request</span>
        </button>
        <a href="/" class="btn btn-outline">
          <span class="t" data-en="Cancel" data-zh="å–æ¶ˆ">Cancel</span>
        </a>
      </div>
    </div>

  </form>
</main>

<style>
  .lang-toggle {
    background: transparent;
    border: 2px solid rgba(192,57,43,0.35);
    color: var(--accent);
    font-family: inherit;
    font-size: 0.85rem;
    font-weight: 700;
    padding: 6px 14px;
    border-radius: 20px;
    cursor: pointer;
    transition: background 0.2s;
    box-shadow: none;
  }
  .lang-toggle:hover {
    background: rgba(192,57,43,0.08);
    transform: none;
    box-shadow: none;
  }
</style>

<script>
  // â”€â”€ Language â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const LABELS = {
    en: { title: 'Procurement Request', sub: 'Central Kitchen Â· Submit a new item request', toggle: 'ä¸­æ–‡' },
    zh: { title: 'é‡‡è´­ç”³è¯·', sub: 'ä¸­å¤®å¨æˆ¿ Â· æäº¤æ–°çš„ç‰©å“ç”³è¯·', toggle: 'EN' }
  };
  const PLACEHOLDERS = {
    en: { item: 'e.g. Commercial Blender / å•†ç”¨æ…æ‹Œæœº', qty: 'e.g. 2', dept: 'e.g. Pastry, Wok Station', name: 'Full name / å…¨å', comments: 'Why is this item needed? Any special notes?' },
    zh: { item: 'ä¾‹ï¼šå•†ç”¨æ…æ‹Œæœº / Commercial Blender', qty: 'ä¾‹ï¼š2ä»¶', dept: 'ä¾‹ï¼šçƒ¤ç„—éƒ¨', name: 'å…¨å / Full Name', comments: 'ä¸ºä»€ä¹ˆéœ€è¦æ­¤ç‰©å“ï¼Ÿæœ‰ç‰¹åˆ«è¯´æ˜å—ï¼Ÿ' }
  };

  let lang = navigator.language.toLowerCase().startsWith('zh') ? 'zh' : 'en';

  function applyLang() {
    document.querySelectorAll('.t').forEach(el => {
      const val = el.dataset[lang];
      if (val) el.textContent = val;
    });
    document.getElementById('hdr-title').textContent  = LABELS[lang].title;
    document.getElementById('hdr-sub').textContent    = LABELS[lang].sub;
    document.getElementById('langToggle').textContent = LABELS[lang].toggle;
    document.getElementById('itemNameInput').placeholder = PLACEHOLDERS[lang].item;
    document.getElementById('qtyInput').placeholder      = PLACEHOLDERS[lang].qty;
    document.getElementById('deptInput').placeholder     = PLACEHOLDERS[lang].dept;
    document.getElementById('nameInput').placeholder     = PLACEHOLDERS[lang].name;
    document.getElementById('commentsInput').placeholder = PLACEHOLDERS[lang].comments;
  }

  function toggleLang() {
    lang = lang === 'en' ? 'zh' : 'en';
    applyLang();
  }

  applyLang();

  // â”€â”€ Image preview â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('imageInput').addEventListener('change', function () {
    const file = this.files[0];
    const preview = document.getElementById('imagePreview');
    if (file) { preview.src = URL.createObjectURL(file); preview.style.display = 'block'; }
    else       { preview.style.display = 'none'; }
  });

  // â”€â”€ Form submit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('requestForm').addEventListener('submit', async function (e) {
    e.preventDefault();
    const msgOk  = document.getElementById('msgSuccess');
    const msgErr = document.getElementById('msgError');
    msgOk.style.display = 'none';
    msgErr.style.display = 'none';
    try {
      const res = await fetch('/api/requests', { method: 'POST', body: new FormData(this) });
      if (!res.ok) { const err = await res.json(); throw new Error(err.error || 'Server error'); }
      msgOk.style.display = 'block';
      this.reset();
      document.getElementById('imagePreview').style.display = 'none';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    } catch (err) {
      document.getElementById('errText').textContent = lang === 'zh' ? `æäº¤å¤±è´¥ï¼š${err.message}` : `Failed: ${err.message}`;
      msgErr.style.display = 'block';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  });
</script>
</body>
</html>