<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>New Procurement Request é‡‡è´­ç”³è¯·</title>
  <link rel="stylesheet" href="css/styles.css"/>
</head>
<body>

<header>
  <h1>ğŸ›’ Procurement Request é‡‡è´­ç”³è¯·</h1>
  <nav class="nav-links">
    <a href="/">ğŸ  Home</a>
    <a href="/requests">ğŸ“Š All Requests</a>
  </nav>
</header>

<main>
  <div id="msgSuccess" class="msg success">âœ… Request submitted successfully! ç”³è¯·æäº¤æˆåŠŸï¼</div>
  <div id="msgError"   class="msg error">âŒ Failed to submit. Please try again.</div>

  <form id="requestForm" enctype="multipart/form-data">

    <!-- Item Details -->
    <div class="card">
      <h2>ğŸ“¦ Item Details ç‰©å“è¯¦æƒ…</h2>
      <div class="form-row">
        <div class="form-group" style="flex:2;">
          <label>Item Name (English) *</label>
          <input type="text" name="itemNameEn" placeholder="e.g. Commercial Blender" required/>
        </div>
        <div class="form-group" style="flex:2;">
          <label>ç‰©å“åç§° (ä¸­æ–‡)</label>
          <input type="text" name="itemNameZh" placeholder="ä¾‹ï¼šå•†ç”¨æ…æ‹Œæœº"/>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Category ç±»åˆ«</label>
          <select name="category">
            <option value="Equipment">Equipment è®¾å¤‡</option>
            <option value="Ingredient">Ingredient é£Ÿæ</option>
            <option value="Consumable">Consumable è€—æ</option>
            <option value="Cleaning">Cleaning æ¸…æ´ç”¨å“</option>
            <option value="Other">Other å…¶ä»–</option>
          </select>
        </div>
        <div class="form-group">
          <label>Priority ä¼˜å…ˆçº§</label>
          <select name="priority">
            <option value="Low">Low ä½</option>
            <option value="Medium" selected>Medium ä¸­</option>
            <option value="High">High é«˜</option>
            <option value="Urgent">ğŸ”´ Urgent ç´§æ€¥</option>
          </select>
        </div>
        <div class="form-group">
          <label>Quantity æ•°é‡</label>
          <input type="text" name="quantity" placeholder="e.g. 2"/>
        </div>
        <div class="form-group">
          <label>Unit å•ä½</label>
          <input type="text" name="unit" placeholder="e.g. pcs, kg, box"/>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Estimated Price é¢„ä¼°ä»·æ ¼ (RM)</label>
          <input type="text" name="estimatedPrice" placeholder="e.g. 350.00"/>
        </div>
        <div class="form-group">
          <label>Suggested Supplier å»ºè®®ä¾›åº”å•†</label>
          <input type="text" name="supplier" placeholder="Optional å¯é€‰"/>
        </div>
        <div class="form-group">
          <label>Date Needed By éœ€è¦æ—¥æœŸ</label>
          <input type="date" name="dateNeeded"/>
        </div>
      </div>
    </div>

    <!-- Requestor Info -->
    <div class="card">
      <h2>ğŸ‘¤ Requestor Info ç”³è¯·äººä¿¡æ¯</h2>
      <div class="form-row">
        <div class="form-group">
          <label>Your Name å§“å *</label>
          <input type="text" name="requestorName" placeholder="Full name å…¨å" required/>
        </div>
        <div class="form-group">
          <label>Department éƒ¨é—¨</label>
          <input type="text" name="department" placeholder="e.g. Pastry, Wok Station"/>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group" style="flex:1;">
          <label>Comments / Reason å¤‡æ³¨ / åŸå› </label>
          <textarea name="comments" placeholder="Why is this item needed? Any special notes? ä¸ºä»€ä¹ˆéœ€è¦æ­¤ç‰©å“ï¼Ÿæœ‰ç‰¹åˆ«è¯´æ˜å—ï¼Ÿ"></textarea>
        </div>
      </div>
    </div>

    <!-- Image Upload -->
    <div class="card">
      <h2>ğŸ“· Photo ç…§ç‰‡ <span style="font-weight:400;font-size:0.85rem;color:var(--muted)">(optional å¯é€‰, max 5MB)</span></h2>
      <div class="form-group">
        <label>Upload image of item or reference ä¸Šä¼ ç‰©å“å›¾ç‰‡æˆ–å‚è€ƒå›¾</label>
        <input type="file" name="image" id="imageInput" accept="image/*"/>
        <span class="hint">Snap a photo of the broken/needed item or a product reference.</span>
        <img id="imagePreview" alt="Preview"/>
      </div>
    </div>

    <div style="display:flex;gap:12px;flex-wrap:wrap;">
      <button type="submit" class="btn btn-primary">âœ… Submit Request æäº¤ç”³è¯·</button>
      <a href="/" class="btn btn-outline">Cancel å–æ¶ˆ</a>
    </div>
  </form>
</main>

<script>
  // Image preview
  document.getElementById('imageInput').addEventListener('change', function () {
    const file = this.files[0];
    const preview = document.getElementById('imagePreview');
    if (file) {
      preview.src = URL.createObjectURL(file);
      preview.style.display = 'block';
    } else {
      preview.style.display = 'none';
    }
  });

  // Form submit
  document.getElementById('requestForm').addEventListener('submit', async function (e) {
    e.preventDefault();
    const msgOk  = document.getElementById('msgSuccess');
    const msgErr = document.getElementById('msgError');
    msgOk.style.display = 'none';
    msgErr.style.display = 'none';

    const formData = new FormData(this);

    try {
      const res = await fetch('/api/requests', { method: 'POST', body: formData });
      if (!res.ok) {
        const err = await res.json();
        throw new Error(err.error || 'Server error');
      }
      msgOk.style.display = 'block';
      this.reset();
      document.getElementById('imagePreview').style.display = 'none';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    } catch (err) {
      msgErr.textContent = `âŒ ${err.message}`;
      msgErr.style.display = 'block';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  });
</script>
</body>
</html>
