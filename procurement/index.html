<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Central Kitchen Procurement</title>
  <link rel="stylesheet" href="css/styles.css"/>
</head>
<body>

<header>
  <h1>ðŸ›’ Central Kitchen Procurement</h1>
  <nav class="nav-links">
    <a href="/requests">ðŸ“Š All Requests</a>
    <a href="/request">+ New Request</a>
  </nav>
</header>

<main>
  <div class="qr-container">
    <h2>Scan to Submit a Request</h2>
    <p>Staff can scan this QR code with any phone or tablet to fill in a procurement request.</p>
    <img class="qr-code" src="/api/qr" alt="QR Code"/>
    <p class="qr-url" id="formUrl"></p>
    <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:8px;">
      <a href="/request" class="btn btn-primary">ðŸ“‹ Open Request Form</a>
      <a href="/requests" class="btn btn-outline">ðŸ“Š View All Requests</a>
      <a href="/api/qr" download="procurement-qr.png" class="btn btn-outline">â¬‡ Download QR</a>
    </div>
  </div>

  <div class="card" style="max-width:500px;margin:0 auto;">
    <h3>Quick Stats</h3>
    <div class="stats-bar" id="statsBar">
      <div class="stat-box"><div class="num" id="statTotal">â€”</div><div class="lbl">Total</div></div>
      <div class="stat-box"><div class="num" id="statPending">â€”</div><div class="lbl">Pending</div></div>
      <div class="stat-box"><div class="num" id="statOrdered">â€”</div><div class="lbl">Ordered</div></div>
      <div class="stat-box"><div class="num" id="statReceived">â€”</div><div class="lbl">Received</div></div>
    </div>
  </div>
</main>

<script>
  document.getElementById('formUrl').textContent = `${window.location.origin}/request`;

  async function loadStats() {
    try {
      const all = await fetch('/api/requests').then(r => r.json());
      document.getElementById('statTotal').textContent   = all.length;
      document.getElementById('statPending').textContent = all.filter(r => r.status === 'Pending').length;
      document.getElementById('statOrdered').textContent = all.filter(r => r.status === 'Ordered').length;
      document.getElementById('statReceived').textContent= all.filter(r => r.status === 'Received').length;
    } catch(_) {}
  }
  loadStats();
</script>
</body>
</html>
